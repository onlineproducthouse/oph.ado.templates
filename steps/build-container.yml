parameters:
  - name: dkrECRUrl
    type: string

  - name: dkrTag
    type: string

  - name: dkrFile
    type: string
    default: Dockerfile

steps:
  - displayName: docker build
    script: |
      echo $(aws ecr get-login-password | docker login --username AWS --password-stdin ${{ parameters.dkrECRUrl }})

      docker buildx create --use --name multiarch

      docker buildx build --push --force-rm --file ${{ parameters.dkrFile }} \
        --build-arg IMAGE_REGISTRY_BASE_URL=${{ parameters.dkrECRUrl }} \
        --tag ${{ parameters.dkrTag }} \
        --platform=linux/arm64,linux/amd64
