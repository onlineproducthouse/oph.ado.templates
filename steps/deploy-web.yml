parameters:
  - name: hostBucket
    type: string

  - name: cdnId
    type: string

  - name: dist
    type: string

  - name: invalidateBatchPath
    type: string

steps:
  - name: DeployWeb
    script: |
      aws s3 sync ${{ parameters.dist }} "s3://${{ parameters.hostBucket }}"

      echo '{
        "Paths": {
          "Quantity": 1,
          "Items": ["/*"]
        },
        "CallerReference": "'$(Build.BuildNumber)'"
      }' >"${{ parameters.invalidateBatchPath }}"

      echo $(aws cloudfront create-invalidation \
        --distribution-id ${{ parameters.cdnId }} \
        --invalidation-batch "file://${{ parameters.invalidateBatchPath }}")
